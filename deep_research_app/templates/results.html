
<!DOCTYPE html>
<html lang="en" data-theme="light"> <!-- Theme applied via JS -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Optional: Add meta description specific to results page -->
    <meta name="description" content="Live progress and final report for the automated research on '{{ topic | e }}'.">
    <title>Research Results: {{ topic | e }}</title>
    <!-- Pico CSS CDN -->
    <link rel="stylesheet" href="{{ pico_css }}">
    <!-- Link the custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='custom.css') }}">

    <!-- Load Libraries Locally: DOMPurify -->
    <!-- Ensure these files exist in deep_research_app/static/js/ -->
    <script src="{{ url_for('static', filename='js/purify.min.js') }}" defer></script>
    <!-- Marked.js is optional now, only needed if client-side rendering is a fallback -->
    <script src="{{ url_for('static', filename='js/marked.min.js') }}" defer></script>

    <style>
        /* Ensure focus states are visible */
         *:focus-visible {
          outline: 2px solid var(--pico-primary-focus);
          outline-offset: 2px;
        }
        /* Style for breadcrumbs */
        nav[aria-label="breadcrumb"] { margin-bottom: 1.5rem; }
    </style>
</head>
<!-- Pass encoded topic to JS via data attribute, properly escaped -->
<body data-encoded-topic="{{ encoded_topic | e }}">
    <main class="container">
        <nav aria-label="breadcrumb">
            <ul>
                <li><a href="{{ url_for('index') }}">New Research</a></li>
                <li>Research Results</li>
            </ul>
        </nav>

        <!-- Main content area -->
        <article>
            <header>
                <hgroup>
                    <h1>Researching: "{{ topic | e }}"</h1>
                    <p>Please wait while the research is conducted. Progress updates will appear below.</p>
                </hgroup>
            </header>

            <!-- Progress Log Section -->
            <section id="progress-section" class="progress-log" aria-live="polite" aria-atomic="false">
                <h2>Progress Log <span id="loader" class="loader"></span></h2>
                <ul id="progress-list">
                    <!-- JS will populate this -->
                    <li>Initializing connection...</li>
                </ul>
            </section>

            <!-- Container for Live Streaming Outputs (Managed by JS) -->
            <section id="report-container" class="hidden">
                <hr>
                <!-- Synthesis Output -->
                <div id="synthesis-output-container">
                    <h2>Live Synthesis Output</h2>
                    <p class="stream-status"><em>Preparing to synthesize information from sources...</em></p>
                    <!-- Role 'log' indicates updates, aria-live polite for screen readers -->
                    <div id="synthesis-output" aria-live="polite" aria-atomic="false" role="log"></div>
                </div>

                <!-- Report Output -->
                <div id="report-output-container">
                    <h2>Live Report Generation</h2>
                    <p class="stream-status"><em>Preparing to generate the final report...</em></p>
                    <div id="report-output" aria-live="polite" aria-atomic="false" role="log"></div>
                </div>
            </section>

            <!-- Container for Final Report (Managed by JS) -->
            <section id="final-report-display" class="hidden">
                <hr>
                <h2>Final Research Report</h2>
                <!-- This div will hold the final, sanitized report HTML -->
                <!-- Role 'document' suitable for final report content -->
                <div id="report-display" role="document">
                    <p><em>Loading final report...</em></p>
                </div>
            </section>

        </article> <!-- End main article wrap -->

    </main>

    <!-- Link the main application JavaScript file -->
    <script src="{{ url_for('static', filename='results.js') }}" defer></script>

    <!-- Theme Application Script -->
     <script>
        // Apply theme from localStorage on load
        const currentTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', currentTheme);
    </script>
</body>
</html>